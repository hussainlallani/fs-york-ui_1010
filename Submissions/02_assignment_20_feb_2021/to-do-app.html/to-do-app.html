<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>jQuery To-Do Application</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <style>
      article,
      aside,
      details,
      figcaption,
      figure,
      footer,
      header,
      hgroup,
      nav,
      section,
      summary {
        display: block;
      }
      audio,
      canvas,
      video {
        display: inline-block;
      }
      audio:not([controls]) {
        display: none;
        height: 0;
      }
      [hidden] {
        display: none;
      }
      html {
        font-family: sans-serif;
        -webkit-text-size-adjust: 100%;
        -ms-text-size-adjust: 100%;
      }
      a:focus {
        outline: thin dotted;
      }
      a:active,
      a:hover {
        outline: 0;
      }
      h1 {
        font-size: 2em;
      }
      abbr[title] {
        border-bottom: 1px dotted;
      }
      b,
      strong {
        font-weight: 700;
      }
      dfn {
        font-style: italic;
      }
      mark {
        background: #ff0;
        color: #000;
      }
      code,
      kbd,
      pre,
      samp {
        font-family: monospace, serif;
        font-size: 1em;
      }
      pre {
        white-space: pre-wrap;
        word-wrap: break-word;
      }
      q {
        quotes: \201c \201d \2018 \2019;
      }
      small {
        font-size: 80%;
      }
      sub,
      sup {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
      }
      sup {
        top: -0.5em;
      }
      sub {
        bottom: -0.25em;
      }
      img {
        border: 0;
      }
      svg:not(:root) {
        overflow: hidden;
      }
      fieldset {
        border: 1px solid silver;
        margin: 0 2px;
        padding: 0.35em 0.625em 0.75em;
      }
      button,
      input,
      select,
      textarea {
        font-family: inherit;
        font-size: 100%;
        margin: 0;
      }
      button,
      input {
        line-height: normal;
      }
      button,html input[type=button],/* 1 */
    input[type=reset],input[type=submit] {
        -webkit-appearance: button;
        cursor: pointer;
      }
      button[disabled],
      input[disabled] {
        cursor: default;
      }
      input[type="checkbox"],
      input[type="radio"] {
        box-sizing: border-box;
        padding: 0;
      }
      input[type="search"] {
        -webkit-appearance: textfield;
        -moz-box-sizing: content-box;
        -webkit-box-sizing: content-box;
        box-sizing: content-box;
      }
      input[type="search"]::-webkit-search-cancel-button,
      input[type="search"]::-webkit-search-decoration {
        -webkit-appearance: none;
      }
      textarea {
        overflow: auto;
        vertical-align: top;
      }
      table {
        border-collapse: collapse;
        border-spacing: 0;
      }
      body,
      figure {
        margin: 0;
      }
      legend,
      button::-moz-focus-inner,
      input::-moz-focus-inner {
        border: 0;
        padding: 0;
      }

      * {
        box-sizing: border-box;
      }

      body {
        font-family: "Helvetica Neue", "Helvetica", "Arial", "sans-serif";
        background-image: url(./paper_bg.jpg);
        background-color: rgba(255, 255, 255, 0.5);
        background-repeat: repeat, repeat;
        background-size: auto;
        min-width: 320px;
      }

      main {
        padding-top: 30px;
        font-weight: 200;
        color: inherit;
        background-color: yellow;
        background-repeat: repeat, repeat;
        background-size: auto;
      }

      main h1 {
        padding: 5px;
      }

      .container {
        max-width: 1200px;
        min-width: 320px;
        width: 100%;
        margin: auto;
      }

      .page-header {
        margin: 0px;
        text-align: center;
      }

      input {
        /* font-size: 18px; */
        /* line-height: 1.3; */
        border-radius: 6px;
        padding: 10px;
      }

      form {
        padding: 5px;
        text-align: center;
      }

      .form-control {
        display: inline-block;
        min-width: 63%;
        height: 50px;
        border: 1px solid #ccc;
        border-radius: 50px;
        box-shadow: inset 0 5px 5px rgba(0, 0, 0, 0.4);
        transition: border-color ease-in-out 0.15s, box-shadow ease-in-out 0.15s;
      }

      /* Remove margins and padding from the list */
      ul {
        padding: 0;
      }

      /* Style the list items */
      ul li {
        cursor: pointer;
        position: relative;
        padding: 12px 8px 12px 40px;
        background: #eee;
        font-size: 18px;
        transition: 0.2s;
        list-style-type: none;
        /* margin-left: -30px; */

        /* make the list items unselectable */
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }

      /* Set all odd list items to a different color (zebra-stripes) */
      ul li:nth-child(odd) {
        background: #f9f9f9;
      }

      /* Darker background-color on hover */
      ul li:hover {
        background: #ddd;
      }

      /* When clicked on, add a background color and strike out text */
      ul li.checked {
        background: #888;
        color: #fff;
        text-decoration: line-through;
      }

      /* Add a "checked" mark when clicked on */
      ul li.checked::before {
        content: "";
        position: absolute;
        border-color: #fff;
        border-style: solid;
        border-width: 0 2px 2px 0;
        top: 10px;
        left: 16px;
        transform: rotate(45deg);
        height: 15px;
        width: 7px;
      }

      /* Style the close button */
      .close {
        position: absolute;
        right: 0;
        top: 0;
        padding: 12px 16px 12px 16px;
      }

      .close:hover {
        background-color: #f44336;
        color: white;
      }

      .alert-msg {
        position: inline-block;
        padding: 10px;
        color: yellow;
        background-color: red;
        width: 100%;
        text-align: center;
        margin: 15px 0 0px 0;
        font-size: 15px;
      }

      #footer-brand {
        float: left;
        width: 34%;
        height: auto;
        text-align: left;
        color: white;
        vertical-align: middle;
        line-height: 30px;
        padding: 5px;
      }

      #todos-count {
        float: left;
        width: 33%;
        text-align: center;
        color: yellow;
        line-height: 30px;
        padding: 5px;
        vertical-align: middle;
      }

      #footer-msg {
        float: left;
        width: 33%;
        text-align: right;
        color: white;
        font-size: 10px;
        line-height: 15px;
        padding: 5px;
        vertical-align: middle;
      }

      footer {
        bottom: 0px;
        font-size: 20px;
        width: 100%;
        text-align: center;
        position: fixed;
        background-color: black;
      }
    </style>
  </head>

  <body>
    <main>
      <div class="container">
        <div class="page-header">
          <h1>Remindos! A jQuery To-Do Application</h1>
        </div>

        <form>
          <div class="alert-msg">Duplicate Entry!</div>
          <input
            class="form-control"
            type="text"
            placeholder="Add an item..."
            autofocus
          />
          <button id="todo-add">+</button>
          <button id="todo-clear">Clear</button>
          <label for="todo-select">Select All</label>
          <input type="checkbox" id="todo-select" />
        </form>

        <ul id="sortable myUL" class="pendingTodo">
          <!-- To do items get added dynamically here -->
          <li>Hit the gym<span class="close">X</span></li>
          <li class="checked">Pay bills</li>
          <li>Meet George</li>
          <li>Buy eggs</li>
          <li>Read a book</li>
          <li>Organize office</li>
        </ul>
      </div>
    </main>
    <footer>
      <span id="footer-brand">Remindos</span>
      <span id="todos-count"> </span>
      <span id="footer-msg">All Rights Reserved. <br />Hussain Lallani</span>
    </footer>

    <script>
      // INSERT CODE HERE
      $("document").ready(function () {
        const itemInputElm = $(".form-control");
        let itemsArr = [];
        let countTodo = 0;
        const checkboxItemStr = 'input[name="todo-checkbox"][type="checkbox"]';

        $(function () {
          // jqueryui sortable
          $("#sortable").sortable();
          $("#sortable").disableSelection();
          // hide duplicate alert msg
          $(".alert-msg").css("visibility", "hidden");
          // bind dynamically created element
          $(document).on("click", ".delete", deleteItem);
          $(document).on(
            "change",
            "input[name=todo-checkbox]",
            toggleItemStatus
          );
          $(document).on("q", "input[name=todo-checkbox]", toggleItemStatus);
          $(document).on("click", ".edit", editItem);
          // $(document).on('click', '.finish', handleItemClick);
        });

        function uid() {
          return Math.floor(Math.random() * Date.now());
        }

        function toggleItemStatus(e) {
          // when item is clicked onchange event triggered
          // let targetCbElm = $(e.target).siblings('input[name="todo-checkbox"][type="checkbox"]');
          // targetCbElm.prop({checked:!targetCbElm.is(':checked')});
          // todoCount();
          updateList(e);
        }

        // function handleItemList(targetId){
        //  let inputElmById = $(`#${targetId}`).children('input[name="todo-checkbox"][type="checkbox"]');
        //  inputElmById.trigger("change")
        //  todoCount();

        //  // handle checkbox change
        //  inputElmById.on("change",function(e){
        //     updateList(e);
        //   });
        // }

        function handleItemClick(e) {
          var DELAY = 300,
            clicks = 0,
            timer = null;
          const targetID = $(e.target)
            .parent()
            .nextUntil("li")
            .children("li")
            .prop("id");

          $(`#${targetID} .finish`)
            .on("click", function (e) {
              clicks++; //count clicks
              if (clicks === 1) {
                timer = setTimeout(function () {
                  // alert("Single Click");  //perform single-click action
                  // handleItemList(`${targetID}`);
                  clicks = 0; //after action performed, reset counter
                }, DELAY);
              } else {
                clearTimeout(timer); //prevent single-click action
                alert("Double Click"); //perform double-click action
                $(`#${targetID} .edit`).trigger("click");
                clicks = 0; //after action performed, reset counter
              }
            })
            .on("dblclick", function (e) {
              e.preventDefault(); //cancel system double-click event
            });
        }

        function addItem() {
          const id = uid();
          // const d = new Date();
          // const time = d.toLocaleTimeString();
          // const date = d.toLocaleDateString();

          itemsArr.push({
            id: id,
            value: itemInputElm.val(),
            isDone: false,
          });

          $("ul").append([
            $("<li/>", { id: id }).append([
              $("<input/>", {
                name: "todo-checkbox",
                type: "checkbox",
                style: "{display:inline-block}",
              }),
              $("<span/>", {
                name: "todoValue",
                contenteditable: "true",
                class: "finish",
              }).text(`${itemInputElm.val()}`),
              $("<button/>", { class: "edit" }).html(`&#9998`),
              $("<button/>", {
                class: "delete",
                style:
                  "font-family: wingdings, font-size:48px;cursor:pointer;display:inline-block",
              }).html("x"),
            ]),
          ]);

          // handleItemList();
          todoCount();
        }

        function handleOnChange() {
          alert("alerted!");
        }

        function deleteItem(event, element) {
          // clear all and del btn both uses deleteItem()
          // clear all sends individual input element
          let $this, liElmId, liElm;
          // alert($(event.target).prop("id"));
          if ($(event.target).prop("id") === "todo-clear") {
            $this = element;
            liElm = $($this).parent();
            liElmId = liElm.prop("id");
            // console.log($($this).parent().prop("id"));
          } else {
            $this = event.target;
            liElmId = $($this).parent().prop("id");
            liElm = $($this).parent();
          }
          itemIndex = itemsArr.findIndex((item) => item.id == liElmId);
          itemsArr.splice(itemIndex, 1);
          // console.log(liElm.prop("tagName"));
          liElm.remove();
          todoCount();
        }

        function updateItem(e, itemSpanElm, itemSpanTxt, itemInputElm) {
          // restore current value if edit input is empty
          if (
            itemInputElm.val().length === 0 &&
            $.trim(itemInputElm.val() === "")
          ) {
            itemInputElm.val(itemSpanTxt);
            itemSpanElm.html(itemInputElm);
            $(e.target)
              .siblings("input .list-item")
              .on("focusout", function (e) {
                alert("focus");
                $(e.target)
                  .siblings("input .list-item")
                  .replaceWith(itemSpanElm);
              });
          }
          // use temporary input element to update the span
          else {
            const itemInputTxt = $.trim(itemInputElm.val());
            itemSpanElm.text($.trim(itemInputTxt));
            const parent = $(e.target).parent();
            $(e.target).siblings("input .list-item").replaceWith(itemSpanElm);
          }
        }

        function setItemStatus(elmId, isItemChecked) {
          isItemChecked;
          itemsArr.filter((item) => {
            if (parseInt(item.id) === parseInt(elmId)) {
              item.isDone = isItemChecked;
              console.log("this item isDone = " + isItemChecked);
            } else {
              item.isDone = !isItemChecked;
              console.log(
                `(${item.id}==${elmId}) this item isDone ` + !isItemChecked
              );
            }
          });
        }

        function editItem(e) {
          // can edit by button or dblclick item
          const targetID = $(e.target).parent().id;
          let $this = $(this);
          const itemSpanElm = $(e.target).siblings('span[name="todoValue"]');
          const itemSpanTxt = itemSpanElm.text();
          // insert input into span element with current value
          const itemInputElm = $("<input/>", { class: "list-item" }).val(
            itemSpanTxt
          );
          // insert new input element to existing span element
          itemSpanElm.html(itemInputElm);
          itemInputElm.focus();

          // edit item on enter
          itemInputElm.on("keyup", function (e) {
            if (e.keyCode === 13) {
              updateItem(e, itemSpanElm, itemSpanTxt, itemInputElm);
            }
          });

          // edit item on focus out
          itemInputElm.on("focusout", function () {
            updateItem(e, itemSpanElm, itemSpanTxt, itemInputElm);
          });
        }

        function updateList(e) {
          const itemList = $('input[name="todo-checkbox"][type="checkbox"]');
          console.log("update function!");
          itemList.each(function () {
            console.log("update: checking each element");
            let $parent = $(this).parent();
            if ($(this).prop("checked")) {
              console.log("update: checking each checked element");
              let elmId = $(this).parent().prop("id");
              setItemStatus(elmId, true);
              $(this)
                .siblings(".finish")
                .css({ textDecoration: "line-through" });
              $("ul").append($parent);
            } else {
              console.log("update: checking element if not checked ");
              let elmId = $(this).parent().prop("id");
              setItemStatus(elmId, false);
              $(this).siblings(".finish").css({ textDecoration: "none" });
              $("ul").prepend($parent);
            }
          });
        }

        $("#todo-add").on("click", (e) => {
          // prevent form submit
          e.preventDefault();
          // get class form-control
          $(".alert-msg").css("visibility", "hidden");
          const isItemDuplicate = itemsArr.filter((item) =>
            item.value.includes($.trim(itemInputElm.val()))
          );
          // Alert for dulicate entries
          if (
            isItemDuplicate.length === 0 &&
            $.trim(itemInputElm.val()) !== ""
          ) {
            addItem();
            itemInputElm.val("");
            handleItemClick(e);
            return $(".alert-msg").css("visibility", "hidden");
          } else {
            if (
              isItemDuplicate.length > 0 &&
              $.trim(itemInputElm.val()) !== ""
            ) {
              $(".alert-msg").html("Duplicate Entry!");
              itemInputElm.val("");
              return $(".alert-msg").css("visibility", "visible");
            } else {
              $(".alert-msg").html("Input is blank!");
              itemInputElm.val("");
              return $(".alert-msg").css("visibility", "visible");
            }
          }
        });

        $("#todo-select").click(function (e) {
          // $('input[name="todo-checkbox"][type="checkbox"]').prop("checked",$(this).prop('checked'));
          $("input:checkbox").not(this).prop("checked", this.checked);
          // handleItemList();
          todoCount();
        });

        $("#todo-clear").on("click", (e) => {
          e.preventDefault();
          $('input[name="todo-checkbox"][type="checkbox"]:checked').each(
            function () {
              // console.log($(this).parent().prop('id'));
              // const elmId = $(this).parent().prop('id');
              // itemIndex = itemsArr.findIndex( item => item.id == elmId);
              // itemsArr.splice(itemIndex,1)
              // $(this).parent().remove();
              deleteItem(e, $(this));
              todoCount();
            }
          );
        });

        function setTabIndex() {
          $("li").each(function (i) {
            i++;
            $(this).prop({ tabindex: i });
          });
        }

        function todoCount() {
          let itemsDone = $(
            'input[name="todo-checkbox"][type="checkbox"]:checked'
          );
          let itemsNotDone = $(
            'input[name="todo-checkbox"][type="checkbox"]'
          ).not(":checked");
          for (i = 0; i < itemsArr.length; i++) {
            console.log(itemsArr[i]);
          }

          if (itemsNotDone.length >= 0) {
            countElm = $("#todos-count");
            countMsg = `${itemsNotDone.length} to-do left`;
            countElm.html(`${countMsg}`);
          }
        }
        setTabIndex();
      });
    </script>
  </body>
</html>
